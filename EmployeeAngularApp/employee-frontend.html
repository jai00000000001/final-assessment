<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .employee-card {
            transition: transform 0.2s;
            margin-bottom: 15px;
        }
        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .loading {
            display: none;
        }
        .error {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-users"></i> Employee Management System
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2><i class="fas fa-list"></i> Employee List</h2>
                        <button class="btn btn-primary" onclick="loadEmployees()">
                            <i class="fas fa-refresh"></i> Load Employees
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div class="text-center loading" id="loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-2">Loading employees...</p>
            </div>

            <!-- Error Alert -->
            <div class="alert alert-danger error" id="errorAlert" role="alert">
                <i class="fas fa-exclamation-triangle"></i> <span id="errorMessage"></span>
            </div>

            <!-- Success Alert -->
            <div class="alert alert-success d-none" id="successAlert" role="alert">
                <i class="fas fa-check-circle"></i> <span id="successMessage"></span>
            </div>

            <!-- Employee List -->
            <div class="row" id="employeeList">
                <!-- Employees will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'http://localhost:5071/api/employee';
        let employees = [];

        // Load employees on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, attempting to load employees...');
            loadEmployees();
        });

        // Load all employees
        async function loadEmployees() {
            console.log('Loading employees from:', API_URL);
            showLoading(true);
            hideError();
            hideSuccess();
            
            try {
                const response = await fetch(API_URL, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                employees = await response.json();
                console.log('Employees loaded:', employees);
                displayEmployees();
                showSuccess(`Successfully loaded ${employees.length} employees`);
                
            } catch (error) {
                console.error('Error loading employees:', error);
                showError('Error loading employees: ' + error.message + '. Make sure the Web API is running on http://localhost:5071');
            } finally {
                showLoading(false);
            }
        }

        // Display employees in cards
        function displayEmployees() {
            const container = document.getElementById('employeeList');
            
            if (employees.length === 0) {
                container.innerHTML = '<div class="col-12"><div class="alert alert-info text-center"><i class="fas fa-info-circle"></i> No employees found.</div></div>';
                return;
            }

            container.innerHTML = employees.map(employee => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card employee-card h-100">
                        <div class="card-body">
                            <h5 class="card-title">
                                <i class="fas fa-user text-primary"></i> ${employee.name}
                            </h5>
                            <p class="card-text">
                                <i class="fas fa-map-marker-alt text-muted"></i> ${employee.address}<br>
                                <i class="fas fa-dollar-sign text-success"></i> ${formatCurrency(employee.salary)}
                            </p>
                            <small class="text-muted">ID: ${employee.id}</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorAlert').classList.remove('error');
            document.getElementById('errorAlert').classList.add('d-block');
        }

        function hideError() {
            document.getElementById('errorAlert').classList.add('error');
            document.getElementById('errorAlert').classList.remove('d-block');
        }

        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successAlert').classList.remove('d-none');
            setTimeout(() => {
                document.getElementById('successAlert').classList.add('d-none');
            }, 3000);
        }

        function hideSuccess() {
            document.getElementById('successAlert').classList.add('d-none');
        }
    </script>
</body>
</html>
