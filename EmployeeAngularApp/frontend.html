<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Management System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .employee-card {
            transition: transform 0.2s;
        }
        .employee-card:hover {
            transform: translateY(-2px);
        }
        .loading {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-users"></i> Employee Management System
                </a>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="container mt-4">
            <!-- Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2><i class="fas fa-list"></i> Employee List</h2>
                        <button class="btn btn-primary" onclick="showAddForm()">
                            <i class="fas fa-plus"></i> Add Employee
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div class="text-center loading" id="loading">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>

            <!-- Error Alert -->
            <div class="alert alert-danger d-none" id="errorAlert" role="alert">
                <i class="fas fa-exclamation-triangle"></i> <span id="errorMessage"></span>
            </div>

            <!-- Employee List -->
            <div class="row" id="employeeList">
                <!-- Employees will be loaded here -->
            </div>

            <!-- Add/Edit Form Modal -->
            <div class="modal fade" id="employeeModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="modalTitle">Add Employee</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <form id="employeeForm">
                                <input type="hidden" id="employeeId">
                                <div class="mb-3">
                                    <label for="name" class="form-label">Name *</label>
                                    <input type="text" class="form-control" id="name" required>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address *</label>
                                    <textarea class="form-control" id="address" rows="3" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="salary" class="form-label">Salary *</label>
                                    <input type="number" class="form-control" id="salary" step="0.01" min="0" required>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="saveEmployee()">Save Employee</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'http://localhost:5071/api/employee';
        let employees = [];

        // Load employees on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadEmployees();
        });

        // Load all employees
        async function loadEmployees() {
            showLoading(true);
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('Failed to load employees');
                employees = await response.json();
                displayEmployees();
                hideError();
            } catch (error) {
                showError('Error loading employees: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Display employees in cards
        function displayEmployees() {
            const container = document.getElementById('employeeList');
            if (employees.length === 0) {
                container.innerHTML = '<div class="col-12"><div class="alert alert-info text-center">No employees found.</div></div>';
                return;
            }

            container.innerHTML = employees.map(employee => `
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card employee-card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${employee.name}</h5>
                            <p class="card-text">
                                <i class="fas fa-map-marker-alt text-muted"></i> ${employee.address}<br>
                                <i class="fas fa-dollar-sign text-success"></i> ${formatCurrency(employee.salary)}
                            </p>
                        </div>
                        <div class="card-footer bg-transparent">
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editEmployee(${employee.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteEmployee(${employee.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show add form
        function showAddForm() {
            document.getElementById('modalTitle').textContent = 'Add Employee';
            document.getElementById('employeeForm').reset();
            document.getElementById('employeeId').value = '';
            new bootstrap.Modal(document.getElementById('employeeModal')).show();
        }

        // Edit employee
        function editEmployee(id) {
            const employee = employees.find(emp => emp.id === id);
            if (!employee) return;

            document.getElementById('modalTitle').textContent = 'Edit Employee';
            document.getElementById('employeeId').value = employee.id;
            document.getElementById('name').value = employee.name;
            document.getElementById('address').value = employee.address;
            document.getElementById('salary').value = employee.salary;
            new bootstrap.Modal(document.getElementById('employeeModal')).show();
        }

        // Save employee (add or edit)
        async function saveEmployee() {
            const form = document.getElementById('employeeForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const employeeData = {
                name: document.getElementById('name').value,
                address: document.getElementById('address').value,
                salary: parseFloat(document.getElementById('salary').value)
            };

            const employeeId = document.getElementById('employeeId').value;
            const isEdit = employeeId !== '';

            try {
                const url = isEdit ? `${API_URL}/${employeeId}` : API_URL;
                const method = isEdit ? 'PUT' : 'POST';
                
                if (isEdit) {
                    employeeData.id = parseInt(employeeId);
                }

                const response = await fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(employeeData)
                });

                if (!response.ok) throw new Error(`Failed to ${isEdit ? 'update' : 'create'} employee`);

                bootstrap.Modal.getInstance(document.getElementById('employeeModal')).hide();
                await loadEmployees();
            } catch (error) {
                showError(`Error ${isEdit ? 'updating' : 'creating'} employee: ` + error.message);
            }
        }

        // Delete employee
        async function deleteEmployee(id) {
            if (!confirm('Are you sure you want to delete this employee?')) return;

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });

                if (!response.ok) throw new Error('Failed to delete employee');

                await loadEmployees();
            } catch (error) {
                showError('Error deleting employee: ' + error.message);
            }
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorAlert').classList.remove('d-none');
        }

        function hideError() {
            document.getElementById('errorAlert').classList.add('d-none');
        }
    </script>
</body>
</html>
